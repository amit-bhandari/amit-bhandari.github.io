<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Android Continuous Integration and Delivery — Next level Android development | Amit Bhandari</title>
<meta name=keywords content="Android,Continuous Integration,Deployment"><meta name=description content="Everything you need to know about Android Continuous Integration and Deployment."><meta name=author content="Amit Bhandari"><link rel=canonical href=http://localhost:1313/posts/android-ci-cd/><link crossorigin=anonymous href=/assets/css/stylesheet.6bffd7a4097c0279f26b1781d82b385208248a19c1bd3579693cc195b019686b.css integrity="sha256-a//XpAl8AnnyaxeB2Cs4UggkihnBvTV5aTzBlbAZaGs=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Android Continuous Integration and Delivery — Next level Android development"><meta property="og:description" content="Everything you need to know about Android Continuous Integration and Deployment."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/android-ci-cd/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-07-09T12:00:30+05:30"><meta property="article:modified_time" content="2018-07-09T12:00:30+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android Continuous Integration and Delivery — Next level Android development"><meta name=twitter:description content="Everything you need to know about Android Continuous Integration and Deployment."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Android Continuous Integration and Delivery — Next level Android development","item":"http://localhost:1313/posts/android-ci-cd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Android Continuous Integration and Delivery — Next level Android development","name":"Android Continuous Integration and Delivery — Next level Android development","description":"Everything you need to know about Android Continuous Integration and Deployment.","keywords":["Android","Continuous Integration","Deployment"],"articleBody":"Android Continuous Integration and Delivery, Everyone is talking about it these days. So what exactly it is and why do you need it? Well following article can explain better than me.\nContinuous integration, explained\nIf you are working on Android project with team of 2 or more and pushing and integrating code on daily basis on VCS, you must use Android Continuous Integration to make your life easier with all those build fails, error and basic test executions. Every time someone pushes code, Android Continuous Integration will build and run unit tests automatically on server and notify you of any errors instantly (it will notify you for successful build as well). How cool is that?\nAs a Android developer, most boring thing in world for me is signing apk, going to play console and uploading it. And again there is this task of uploading deobfuscation file of trace logs. Thanks to google, they exposed google play console API for automating that stuff too. Well, wouldn’t it be awesome if you just merge your code in your master, and your Android Continuous Integration server uploads signed apk and deobfuscation file to your play console for you? Off course it will be.\nIf you want to set up this arrangement for your Android project, go on reading the article as I would try to mention all the steps necessary to set up the system, but if I do miss something, do not threaten to kill my family, just ask nicely and I would help you out.\nP.S. This process is not as simple as double click on installer.exe -\u003e next -\u003e next -\u003e finish -\u003e launch, it’s highly likely you may run into shit load of problems (or you may not), but don’t give up and after successful setup, you will thank yourself for life. It took me almost a day to set this up as I was very new to CI thing. If you face any issue, you can always drop comment below and I will try to help you out.\nAndroid Continuous Integration (CI) Jenkins is the name which pops up in head of most people when they hear the phrase CI, it is most used, Java based, open source automation server. But I personally found Team City by JetBrains (yes, same awesome people who came up with Kotlin and Android Studio) much easier to configure and use. Even though Team City is proprietary software with commercial license, they provide Freemium license up to 100 build configurations (which is more than enough for Hobbyist like me). Without wasting any time, let’s get started installing team city in your server. (It can be installed in your computer as well if you are the only person working on project)\nInstallation on Linux For other OS, refer official installation quick start guide\nDownload latest version in tar.gz from official website. Open up terminal, change directory to downloads and issue simple ‘tar xfz TeamCity.tar.gz’ to unzip the content in same directory. To start Team City server, move to TeamCity/bin directory and give ‘runAll.sh start’ command. To stop, give ‘runAll.sh stop’. You could create alias in your bashrc file or mention command in startup program list to automatically start TC server on startup. By default team city runs on 8111 port, so open up a browser and browse to http://localhost:8111/ to set up build configurations. Follow this for first time set up and account creation.\nNow create your first project on Team City by clicking on Administration on top right corner. There are several options provided to create project i.e. from Github, Bitbucket, Repository URL or manual setup. You could setup Github connection in your TC by providing credentials and TC will list all your repositories to choose from.\nAndroid Continuous Integration Setup on Team City[/caption]\nSelect repository you want to setup CI for and click on Proceed.\n//image 2\nAndroid Continuous Integration Setup on Team City[/caption]\nTC will try to auto read build steps for project by going through project files and find the correct one most of the times, if not, you can always provide the build steps manually\n//image 3\nAndroid Continuous Integration Setup on Team City[/caption]\nSelect Gradle and click on use selected. (later we will modify build steps to include auto upload of signed apk to play console)\nBy default, TC will take master branch of repository as default one for setting up VCS trigger for starting build. TC will periodically check for any changes on repository and initiate build as soon as new code is pushed to it. You can customize almost everything in project settings, like default branch, repository checking interval etc.\nI personally like to keep 3 branches in my android project on Git i.e. master (release build), beta (alpha/beta build) and development (where I commit crap on hourly basis). I set up my VCS trigger on ‘beta’ branch so that whenever I push any changes (or merge) to ‘beta’, automatic build and deployment will happen in TC. And I don’t even have to manually upload release.apk and mapping.txt on console.\nTo edit default branch of your project (change VCS trigger to beta branch in my case), go to Project Settings -\u003e VCS Roots -\u003e Edit (on particular VCS root) -\u003e Default branch and update its value.\n//image 4\nAndroid Continuous Integration Setup on Team City //image 5\nAnd your TC is setup to check beta branch every 1 minute and checkout changes (if any) and build the project. You can setup notification system to notify you in case of failure (or success as well) via email. Explore the thing in your TC settings.\nContinuous Delivery (CD) Now comes the exciting part, automatic upload of release apk to alpha/beta/production and mapping.txt to De-obfuscation files in your play console. Google provides play console API for doing this and fortunately (as always), some good people came together to write a library to make it super easy for us to use it in our project without dealing with APIs our self. (If you just had Thumbs Up and want to do something TOOFANI, go ahead and consume those APIs for yourself)\nBefore getting started with Gradle Play Publisher, make sure you provide proper signing info in your gradle file so that it can automatically sign your apk with your key and initiate upload. There are multiple ways you could mention signing info in your gradle file, one being mentioning passwords and key file path directly in gradle file itself, but its extremely insecure and could expose your passwords to anyone having access to code.\nSigning info in Gradle file Best way is to write those details in external file, list that file in your .gitignore and read values from that file in your build.gradle. Create new file at root directory of project and name it keystore.properties and enter this 5 entries in it(with your values). Don’t worry about p12 file yet, I will tell you how to get it shortly.\nstoreFile=/key/file/path.jks keyAlias=key0 storePassword=notasecret keyPassword=notasecret p12keyFile=/path/to/your/p12key/file/Google Play Android Developer-2355232355.p12 And reference this file and values in build.gradle like this.\n// Load keystore def keystorePropertiesFile = rootProject.file(\"/path/to/your/keystore.properties\") def keystoreProperties = new Properties() keystoreProperties.load(new FileInputStream(keystorePropertiesFile)) android{ signingConfigs{ release { storeFile file(keystoreProperties['storeFile']) storePassword keystoreProperties['storePassword'] keyAlias keystoreProperties['keyAlias'] keyPassword keystoreProperties['keyPassword'] } } buildTypes { release { signingConfig signingConfigs.release ... } } } Source for this info To make sure your signing info is correct and works, choose ‘release’ build variant from ‘Build Variants’ tab on lower left side of Android Studio (if you are using Eclipse, seriously?) and try installing app on device. If no error, good to go. If errors, google is always there to help. (before rushing to google by copying error blindly, read it. Most of the times, error arises because of our stupid mistake)\nEnabling play console API access and getting p12 key file To get started using play console API, we need p12 key file and instructions to link your project and creating service account is nicely documented by google here.\nMain steps are\nGoing to API access page in developer console and linking your project by clicking on link. //image 6 We need to set up API access client by creating service account. You will see option to create service account on the same page below under ‘Service Accounts’ section. //image 7 Click on ‘grant access’ and give required permissions. //image 8 Once your service account is set up, go to Google API Console, open up credentials from left navigation, click on create credentials -\u003e Service account key -\u003e Choose your service account -\u003e Choose P12 and click create. This will download P12 key file in your browser. Do not share this file with anyone.\n//image 9\nOnce you successfully got key file, place it somewhere in your server securely (make sure you don’t include the file in VCS) and mention that path in keystore.properties file. Now mention your service account email and apk upload track (alpha, beta or prod) in build.gradle like this. (Refer documentation for all the options and how to use them)\nplay { track = 'alpha' serviceAccountEmail = 'ab-***t@api-********************-54989.iam.gserviceaccount.com' pk12File = file(keystoreProperties['p12keyFile']) } And sync your project with gradle. To make sure signing info is correctly set up and your build is ready to upload apk to console upon successful build, go to terminal and change working directory to your root android project and give command ‘./gradlew tasks’ and you should be able to see all the available play store tasks (you will not see ‘publishApkRelease’ if there is problem in your signing info in build.gradle)\n//image 10\nYou can test your apk upload task by running ‘./gradlew publishApkRelease’ in terminal right away. It should invoke build and upload release.apk along with the de-obfuscation to your play console.\nSetting up TC to upload your apk I keep my repository organized in 3 branches as discussed earlier. I have set beta branch of my code to invoke build and publishApkRelease on Android Continuous Integration TC server. You could set up your system as per your requirement and liking. All you have to do is mention ‘publishApkRelease’ task in your build steps in TC Project Settings like below.\n//image 11\nNow you can test your Android Continuous Integration setup by pushing test changes on branch (‘beta’ in my case). I hope you don’t face any error which google won’t be able to help with.\nThis article was originally written on medium here\n","wordCount":"1734","inLanguage":"en","datePublished":"2018-07-09T12:00:30+05:30","dateModified":"2018-07-09T12:00:30+05:30","author":{"@type":"Person","name":"Amit Bhandari"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/android-ci-cd/"},"publisher":{"@type":"Organization","name":"Amit Bhandari","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Amit Bhandari (Alt + H)">Amit Bhandari</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/archives/ title=Archives><span>Archives</span></a></li><li><a href="https://docs.google.com/document/d/1MORtouBEh73fB4GKWPjOEz4V5QeBQitM_DC_U223agM/edit?usp=sharing" title=Resume><span>Resume</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Android Continuous Integration and Delivery — Next level Android development</h1><div class=post-description>Everything you need to know about Android Continuous Integration and Deployment.</div><div class=post-meta><span title='2018-07-09 12:00:30 +0530 IST'>July 9, 2018</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Amit Bhandari</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#android-continuous-integration-ci aria-label="Android Continuous Integration (CI)">Android Continuous Integration (CI)</a><ul><li><a href=#installation-on-linux aria-label="Installation on Linux">Installation on Linux</a></li></ul></li><li><a href=#continuous-delivery-cd aria-label="Continuous Delivery (CD)">Continuous Delivery (CD)</a><ul><li><a href=#signing-info-in-gradle-file aria-label="Signing info in Gradle file">Signing info in Gradle file</a></li><li><a href=#enabling-play-console-api-access-and-getting-p12-key-file aria-label="Enabling play console API access and getting p12 key file">Enabling play console API access and getting p12 key file</a></li><li><a href=#setting-up-tc-to-upload-your-apk aria-label="Setting up TC to upload your apk">Setting up TC to upload your apk</a></li></ul></li></ul></div></details></div><div class=post-content><p>Android Continuous Integration and Delivery, Everyone is talking about it these days.
So what exactly it is and why do you need it? Well following article can explain better than me.</p><p><a href=https://aws.amazon.com/devops/continuous-integration/>Continuous integration, explained</a></p><p>If you are working on Android project with team of 2 or more and pushing and integrating code on daily basis on VCS, you must use Android Continuous Integration to make your life easier with all those build fails, error and basic test executions.
Every time someone pushes code, Android Continuous Integration will build and run unit tests automatically on server and notify you of any errors instantly (it will notify you for successful build as well).
How cool is that?</p><p>As a Android developer, most boring thing in world for me is signing apk, going to play console and uploading it.
And again there is this task of uploading deobfuscation file of trace logs.
Thanks to google, they exposed google play console API for automating that stuff too.
Well, wouldn’t it be awesome if you just merge your code in your master, and your Android Continuous Integration server uploads signed apk and deobfuscation file to your play console for you? Off course it will be.</p><p>If you want to set up this arrangement for your Android project,
go on reading the article as I would try to mention all the steps necessary to set up the system,
but if I do miss something, do not threaten to kill my family, just ask nicely and I would help you out.</p><p><em>P.S. This process is not as simple as double click on installer.exe -> next -> next -> finish -> launch, it’s highly likely you may run into shit load of problems (or you may not),
but don’t give up and after successful setup, you will thank yourself for life.
It took me almost a day to set this up as I was very new to CI thing.
If you face any issue, you can always drop comment below and I will try to help you out.</em></p><hr><h2 id=android-continuous-integration-ci>Android Continuous Integration (CI)<a hidden class=anchor aria-hidden=true href=#android-continuous-integration-ci>#</a></h2><p>Jenkins is the name which pops up in head of most people when they hear the phrase CI, it is most used,
Java based, open source automation server. But I personally found Team City by JetBrains
(yes, same awesome people who came up with Kotlin and Android Studio) much easier to configure and use.
Even though Team City is proprietary software with commercial license,
they provide Freemium license up to 100 build configurations (which is more than enough for Hobbyist like me).
Without wasting any time, let’s get started installing team city in your server.
(It can be installed in your computer as well if you are the only person working on project)</p><h3 id=installation-on-linux>Installation on Linux<a hidden class=anchor aria-hidden=true href=#installation-on-linux>#</a></h3><p>For other OS, refer official <a href=https://confluence.jetbrains.com/display/TCD10/Installation+Quick+Start>installation</a> quick start guide</p><p><a href=https://www.jetbrains.com/teamcity/download/>Download</a> latest version in tar.gz from official website.
Open up terminal, change directory to downloads and issue simple ‘tar xfz TeamCity.tar.gz’ to unzip the content in same directory.
To start Team City server, move to TeamCity/bin directory and give ‘runAll.sh start’ command. To stop, give ‘runAll.sh stop’. You could create alias in your bashrc file or mention command in startup program list to automatically start TC server on startup.
By default team city runs on 8111 port, so open up a browser and browse to http://localhost:8111/ to set up build configurations. Follow <a href=https://confluence.jetbrains.com/display/TCD10/Installation+Quick+Start#InstallationQuickStart-StartTeamCityfortheFirstTime>this</a> for first time set up and account creation.</p><p>Now create your first project on Team City by clicking on Administration on top right corner.
There are several options provided to create project i.e. from Github, Bitbucket, Repository URL or manual setup.
You could setup Github connection in your TC by providing credentials and TC will list all your repositories to choose from.</p><p><img loading=lazy src=static/ci/1_ci.webp alt=regular></p><p>Android Continuous Integration Setup on Team City[/caption]</p><p>Select repository you want to setup CI for and click on Proceed.</p><p>//image 2</p><p>Android Continuous Integration Setup on Team City[/caption]</p><p>TC will try to auto read build steps for project by going through project files and find the correct one most of the times,
if not, you can always provide the build steps manually</p><p>//image 3</p><p>Android Continuous Integration Setup on Team City[/caption]</p><p>Select <strong>Gradle</strong> and click on use selected. (later we will modify build steps to include auto upload of signed apk to play console)</p><p>By default, TC will take master branch of repository as default one for setting up VCS trigger for starting build.
TC will periodically check for any changes on repository and initiate build as soon as new code is pushed to it.
You can customize almost everything in project settings, like default branch, repository checking interval etc.</p><p>I personally like to keep 3 branches in my android project on Git i.e. master (release build), beta (alpha/beta build) and development (where I commit crap on hourly basis).
I set up my VCS trigger on ‘beta’ branch so that whenever I push any changes (or merge) to ‘beta’, automatic build and deployment will happen in TC.
<strong>And I don’t even have to manually upload release.apk and mapping.txt on console.</strong></p><p>To edit default branch of your project (change VCS trigger to beta branch in my case),
go to <strong>Project Settings -> VCS Roots -> Edit (on particular VCS root) -> Default branch</strong> and update its value.</p><p>//image 4</p><p>Android Continuous Integration Setup on Team City
//image 5</p><p>And your TC is setup to check beta branch every 1 minute and checkout changes (if any) and build the project.
You can setup notification system to notify you in case of failure (or success as well) via email.
Explore the thing in your TC settings.</p><hr><h2 id=continuous-delivery-cd>Continuous Delivery (CD)<a hidden class=anchor aria-hidden=true href=#continuous-delivery-cd>#</a></h2><p>Now comes the exciting part, automatic upload of release apk to alpha/beta/production and mapping.txt to De-obfuscation files in your play console.
Google provides play console API for doing this and fortunately (as always), some good people came together to write a <a href=https://github.com/Triple-T/gradle-play-publisher>library</a> to make it super easy for us to use it in our project without dealing with APIs our self.
(If you just had Thumbs Up and want to do something TOOFANI, go ahead and consume those APIs for yourself)</p><p>Before getting started with <a href=https://github.com/Triple-T/gradle-play-publisher>Gradle Play Publisher</a>, make sure you provide proper signing info in your gradle file so that it can automatically sign your apk with your key and initiate upload.
There are multiple ways you could mention signing info in your gradle file, one being mentioning passwords and key file path directly in gradle file itself,
but its extremely insecure and could expose your passwords to anyone having access to code.</p><h3 id=signing-info-in-gradle-file>Signing info in Gradle file<a hidden class=anchor aria-hidden=true href=#signing-info-in-gradle-file>#</a></h3><p>Best way is to write those details in external file, list that file in your .gitignore and read values from that file in your build.gradle.
Create new file at root directory of project and name it keystore.properties and enter this 5 entries in it(with your values).
Don’t worry about p12 file yet, I will tell you how to get it shortly.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>storeFile</span><span class=o>=</span><span class=s>/key/file/path.jks</span>
</span></span><span class=line><span class=cl><span class=na>keyAlias</span><span class=o>=</span><span class=s>key0</span>
</span></span><span class=line><span class=cl><span class=na>storePassword</span><span class=o>=</span><span class=s>notasecret</span>
</span></span><span class=line><span class=cl><span class=na>keyPassword</span><span class=o>=</span><span class=s>notasecret</span>
</span></span><span class=line><span class=cl><span class=na>p12keyFile</span><span class=o>=</span><span class=s>/path/to/your/p12key/file/Google Play Android Developer-2355232355.p12</span></span></span></code></pre></div><p>And reference this file and values in build.gradle like this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=c1>// Load keystore
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>def</span> <span class=n>keystorePropertiesFile</span> <span class=o>=</span> <span class=n>rootProject</span><span class=o>.</span><span class=na>file</span><span class=o>(</span><span class=s2>&#34;/path/to/your/keystore.properties&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kt>def</span> <span class=n>keystoreProperties</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=n>keystoreProperties</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>keystorePropertiesFile</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>android</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>signingConfigs</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>release</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>storeFile</span> <span class=nf>file</span><span class=o>(</span><span class=n>keystoreProperties</span><span class=o>[</span><span class=s1>&#39;storeFile&#39;</span><span class=o>])</span>
</span></span><span class=line><span class=cl>            <span class=n>storePassword</span> <span class=n>keystoreProperties</span><span class=o>[</span><span class=s1>&#39;storePassword&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>            <span class=n>keyAlias</span> <span class=n>keystoreProperties</span><span class=o>[</span><span class=s1>&#39;keyAlias&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>            <span class=n>keyPassword</span> <span class=n>keystoreProperties</span><span class=o>[</span><span class=s1>&#39;keyPassword&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>buildTypes</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>release</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>signingConfig</span> <span class=n>signingConfigs</span><span class=o>.</span><span class=na>release</span>
</span></span><span class=line><span class=cl>            <span class=o>...</span> 
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><p>Source for this <a href=https://stackoverflow.com/questions/20562189/sign-apk-without-putting-keystore-info-in-build-gradle/33218300#33218300>info</a>
To make sure your signing info is correct and works, choose ‘release’ build variant from ‘Build Variants’ tab on lower left side of Android Studio (if you are using Eclipse, seriously?) and try installing app on device. If no error, good to go. If errors, google is always there to help. (before rushing to google by copying error blindly, read it. Most of the times, error arises because of our stupid mistake)</p><h3 id=enabling-play-console-api-access-and-getting-p12-key-file>Enabling play console API access and getting p12 key file<a hidden class=anchor aria-hidden=true href=#enabling-play-console-api-access-and-getting-p12-key-file>#</a></h3><p>To get started using play console API, we need p12 key file and instructions to link your project and creating service account is nicely documented by google <a href=https://developers.google.com/android-publisher/getting_started>here</a>.</p><p>Main steps are</p><ol><li>Going to API access page in developer console and linking your project by clicking on link.
//image 6</li><li>We need to set up API access client by creating service account.
You will see option to create service account on the same page below under ‘Service Accounts’ section.
//image 7</li><li>Click on ‘grant access’ and give required permissions.
//image 8</li></ol><p>Once your service account is set up, go to <a href=https://console.developers.google.com/>Google API Console</a>, open up credentials from left navigation, click on <strong>create credentials -> Service account key -> Choose your service account -> Choose P12 and click create.</strong>
This will download P12 key file in your browser. <strong>Do not share this file with anyone.</strong></p><p>//image 9</p><p>Once you successfully got key file, place it somewhere in your server securely (make sure you don’t include the file in VCS) and mention that path in keystore.properties file.
Now mention your service account email and apk upload track (alpha, beta or prod) in build.gradle like this.
(Refer <a href=https://github.com/Triple-T/gradle-play-publisher>documentation</a> for all the options and how to use them)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>play</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span> <span class=o>=</span> <span class=s1>&#39;alpha&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>serviceAccountEmail</span> <span class=o>=</span> <span class=s1>&#39;ab-***t@api-********************-54989.iam.gserviceaccount.com&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>pk12File</span> <span class=o>=</span> <span class=n>file</span><span class=o>(</span><span class=n>keystoreProperties</span><span class=o>[</span><span class=s1>&#39;p12keyFile&#39;</span><span class=o>])</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><p>And sync your project with gradle. To make sure signing info is correctly set up and your build is ready to upload apk to console upon successful build, go to terminal and change working directory to your root android project and give command <em>‘./gradlew tasks’</em> and you should be able to see all the available play store tasks
(you will not see ‘publishApkRelease’ if there is problem in your signing info in build.gradle)</p><p>//image 10</p><p>You can test your apk upload task by running ‘./gradlew publishApkRelease’ in terminal right away.
It should invoke build and upload release.apk along with the de-obfuscation to your play console.</p><h3 id=setting-up-tc-to-upload-your-apk>Setting up TC to upload your apk<a hidden class=anchor aria-hidden=true href=#setting-up-tc-to-upload-your-apk>#</a></h3><p>I keep my repository organized in 3 branches as discussed earlier.
I have set beta branch of my code to invoke build and publishApkRelease on Android Continuous Integration TC server.
You could set up your system as per your requirement and liking.
All you have to do is mention ‘publishApkRelease’ task in your build steps in TC Project Settings like below.</p><p>//image 11</p><p>Now you can test your Android Continuous Integration setup by pushing test changes on branch (‘beta’ in my case).
<strong>I hope you don’t face any error which google won’t be able to help with.</strong></p><hr><p>This article was originally written on medium <a href=https://medium.com/@amit-bhandari/android-continuous-integration-and-delivery-next-level-android-development-cfc67405a56b>here</a></p><hr></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/android/>Android</a></li><li><a href=http://localhost:1313/tags/continuous-integration/>Continuous Integration</a></li><li><a href=http://localhost:1313/tags/deployment/>Deployment</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/image-view-extension/><span class=title>Next »</span><br><span>Extend Image View to allow URL binding in xml directly</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Amit Bhandari</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>